{
  "version": "4.1",
  "description": "增强版统一规则语法数据库 - 支持多平台规则转换",
  "last_updated": "2025-09-02",
  "author": "AI Assistant",
  "database_integrity": {
    "checksum": "sha256:...",
    "validation_rules": "complete",
    "normalization_rules": "enhanced",
    "compatibility_mapping": "detailed"
  },
  "syntax_patterns": {
    "comment": "^[!#]",
    "exception_rule": "^@@",
    "domain_rule": "^\\|\\|([^\\^\\n]+)\\^",
    "url_rule": "^\\|([^\\|\\n]+)\\|",
    "regex_rule": "^/(.*)/$",
    "hosts_rule": "^(?:\\d{1,3}\\.){3}\\d{1,3}\\s+[^\\s]+",
    "element_hiding_basic": "##[^#\\n]+$",
    "element_hiding_exception": "#@#[^#\\n]+$",
    "extended_css": "#\\?#[^#\\n]+$",
    "adguard_scriptlet": "#%#[^#\\n]+$",
    "adguard_dns_rule": "^\\|\\|[^\\^\\n]*\\^\\$dnstype=",
    "adguard_stealth_rule": "^\\|\\|[^\\^\\n]*\\^\\$stealth",
    "adguard_redirect_rule": "\\$redirect=[^\\s]+",
    "adguard_removeparam_rule": "\\$removeparam=[^\\s]+",
    "adguard_csp_rule": "\\$csp=[^\\s]+",
    "adguard_replace_rule": "\\$replace=[^\\s]+",
    "adguard_cookie_rule": "\\$cookie=[^\\s]+",
    "adguard_generichide": "\\$generichide(?:=|$)",
    "adguard_specific_domain": "^[a-zA-Z0-9](?:[a-zA-Z0-9.-]*[a-zA-Z0-9])?$",
    "adguard_home_dns_rewrite": "\\$dnsrewrite=[^\\s]+",
    "adguard_home_client": "\\$client=[^\\s]+",
    "adguard_home_dnstype": "\\$dnstype=[^\\s]+",
    "adguard_important": "\\$important(?:=|$)",
    "adguard_badfilter": "\\$badfilter(?:=|$)",
    "adguard_empty": "\\$empty(?:=|$)",
    "adguard_mp4": "\\$mp4(?:=|$)",
    "adguard_websocket": "\\$websocket(?:=|$)",
    "adguard_webrtc": "\\$webrtc(?:=|$)",
    "adguard_denyallow": "\\$denyallow=[^\\s]+",
    "adguard_app": "\\$app=[^\\s]+",
    "adguard_network": "\\$network=[^\\s]+",
    "adguard_method": "\\$method=[^\\s]+",
    "adguard_specifichide": "\\$specifichide(?:=|$)",
    "adguard_content": "\\$content(?:=|$)",
    "adguard_popup": "\\$popup(?:=|$)",
    "adguard_header": "\\$header=[^\\s]+",
    "adguard_jsonprune": "\\$jsonprune=[^\\s]+",
    "adguard_hls": "\\$hls(?:=|$)",
    "adguard_all": "\\$all(?:=|$)",
    "pihole_domain": "^[a-zA-Z0-9](?:[a-zA-Z0-9.-]*[a-zA-Z0-9])?$",
    "surge_domain_suffix": "^DOMAIN-SUFFIX,[^,]+,[^,]+$",
    "surge_domain_keyword": "^DOMAIN-KEYWORD,[^,]+,[^,]+$",
    "surge_url_regex": "^URL-REGEX,[^,]+,[^,]+$",
    "surge_ip_cidr": "^IP-CIDR(6)?,[^,]+,[^,]+$"
  },
  "rule_types": {
    "comment": "invalid",
    "exception_rule": "allow",
    "domain_rule": "block",
    "url_rule": "block",
    "regex_rule": "block",
    "hosts_rule": "block",
    "element_hiding_basic": "cosmetic",
    "element_hiding_exception": "cosmetic_allow",
    "extended_css": "cosmetic_extended",
    "adguard_scriptlet": "scriptlet",
    "adguard_dns_rule": "block",
    "adguard_stealth_rule": "block",
    "adguard_redirect_rule": "block",
    "adguard_removeparam_rule": "block",
    "adguard_csp_rule": "block",
    "adguard_replace_rule": "block",
    "adguard_cookie_rule": "block",
    "adguard_generichide": "cosmetic",
    "adguard_specific_domain": "block",
    "adguard_home_dns_rewrite": "dns_rewrite",
    "adguard_home_client": "client_block",
    "adguard_home_dnstype": "dns_type_block",
    "adguard_important": "modifier",
    "adguard_badfilter": "modifier",
    "adguard_empty": "modifier",
    "adguard_mp4": "modifier",
    "adguard_websocket": "modifier",
    "adguard_webrtc": "modifier",
    "adguard_denyallow": "modifier",
    "adguard_app": "modifier",
    "adguard_network": "modifier",
    "adguard_method": "modifier",
    "adguard_specifichide": "cosmetic",
    "adguard_content": "modifier",
    "adguard_popup": "modifier",
    "adguard_header": "modifier",
    "adguard_jsonprune": "modifier",
    "adguard_hls": "modifier",
    "adguard_all": "modifier",
    "pihole_domain": "block",
    "surge_domain_suffix": "block",
    "surge_domain_keyword": "block",
    "surge_url_regex": "block",
    "surge_ip_cidr": "block"
  },
  "modifiers": {
    "domain": "domain=([^\\s,]+)",
    "third-party": "third-party",
    "first-party": "~third-party",
    "script": "script",
    "image": "image",
    "stylesheet": "stylesheet",
    "object": "object",
    "xmlhttprequest": "xmlhttprequest",
    "subdocument": "subdocument",
    "document": "document",
    "elemhide": "elemhide",
    "other": "other",
    "match-case": "match-case",
    "collapse": "collapse",
    "donottrack": "donottrack",
    "websocket": "websocket",
    "webrtc": "webrtc",
    "dnstype": "dnstype=([^\\s,]+)",
    "dnsrewrite": "dnsrewrite=([^\\s,]+)",
    "important": "important",
    "badfilter": "badfilter",
    "empty": "empty",
    "mp4": "mp4",
    "redirect": "redirect=([^\\s,]+)",
    "redirect-rule": "redirect-rule=([^\\s,]+)",
    "removeparam": "removeparam=([^\\s,]+)",
    "csp": "csp=([^\\s,]+)",
    "replace": "replace=([^\\s,]+)",
    "cookie": "cookie=([^\\s,]+)",
    "generichide": "generichide",
    "specifichide": "specifichide",
    "stealth": "stealth",
    "client": "client=([^\\s,]+)",
    "denyallow": "denyallow=([^\\s,]+)",
    "app": "app=([^\\s,]+)",
    "network": "network=([^\\s,]+)",
    "method": "method=([^\\s,]+)",
    "adguard_home_noerror": "noerror",
    "adguard_home_answer": "answer=([^\\s,]+)",
    "content": "content",
    "popup": "popup",
    "extension_css_has": ":-ext-has\\(",
    "extension_css_contains": ":-ext-contains\\(",
    "extension_css_matches_css": ":-ext-matches-css\\(",
    "genericblock": "genericblock",
    "jsonprune": "jsonprune=",
    "urlblock": "urlblock",
    "header": "header=",
    "removeheader": "removeheader=",
    "hls": "hls",
    "all": "all"
  },
  "platform_support": {
    "adguard": {
      "supported_rule_types": ["domain_rule", "exception_rule", "element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_dns_rule", "adguard_stealth_rule", "regex_rule", "hosts_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all"],
      "unsupported_rule_types": [],
      "unsupported_modifiers": [],
      "conversion_notes": "原生AdGuard格式，支持所有功能"
    },
    "adguard_home": {
      "supported_rule_types": ["domain_rule", "exception_rule", "adguard_dns_rule", "adguard_home_dns_rewrite", "adguard_home_client", "adguard_home_dnstype", "hosts_rule", "regex_rule", "adguard_important", "adguard_badfilter", "adguard_denyallow"],
      "unsupported_rule_types": ["element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all"],
      "unsupported_modifiers": ["removeparam", "csp", "replace", "cookie", "redirect", "header", "scriptlet", "elemhide", "generichide", "specifichide", "jsonprune", "hls", "all"],
      "special_modifiers": ["client", "dnstype", "dnsrewrite", "important", "badfilter", "denyallow"],
      "conversion_notes": "DNS级别过滤，不支持页面内容修改"
    },
    "clash": {
      "supported_rule_types": ["domain_rule", "exception_rule", "regex_rule"],
      "unsupported_rule_types": ["element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule"],
      "supported_modifiers": ["domain", "important"],
      "rule_format": {
        "domain_rule": "DOMAIN-SUFFIX,{domain},{action}",
        "exception_rule": "DOMAIN-SUFFIX,{domain},DIRECT",
        "regex_rule": "DOMAIN-KEYWORD,{pattern},{action}"
      },
      "conversion_notes": "使用Clash规则格式，支持域名和正则匹配"
    },
    "surge": {
      "supported_rule_types": ["domain_rule", "exception_rule", "regex_rule", "surge_domain_suffix", "surge_domain_keyword", "surge_url_regex", "surge_ip_cidr"],
      "unsupported_rule_types": ["element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule"],
      "supported_modifiers": ["domain", "important"],
      "rule_format": {
        "domain_rule": "DOMAIN-SUFFIX,{domain},{action}",
        "exception_rule": "DOMAIN-SUFFIX,{domain},DIRECT",
        "regex_rule": "URL-REGEX,{pattern},{action}",
        "surge_domain_suffix": "{rule}",
        "surge_domain_keyword": "{rule}",
        "surge_url_regex": "{rule}",
        "surge_ip_cidr": "{rule}"
      },
      "conversion_notes": "使用Surge规则格式，支持域名、URL正则和IP CIDR匹配"
    },
    "mihomo": {
      "supported_rule_types": ["domain_rule", "exception_rule"],
      "unsupported_rule_types": ["element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "regex_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule"],
      "supported_modifiers": ["domain", "important"],
      "conversion_notes": "需要从Clash规则编译为MRS格式，不支持复杂正则",
      "compilation_required": true,
      "source_platform": "clash"
    },
    "pihole": {
      "supported_rule_types": ["domain_rule", "exception_rule", "hosts_rule", "pihole_domain"],
      "unsupported_rule_types": ["element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "regex_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule"],
      "rule_format": {
        "domain_rule": "{domain}",
        "exception_rule": "@@{domain}",
        "hosts_rule": "0.0.0.0 {domain}",
        "pihole_domain": "{domain}"
      },
      "conversion_notes": "仅支持简单域名规则，不支持修饰符"
    },
    "ublock_origin": {
      "supported_rule_types": ["domain_rule", "exception_rule", "element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "regex_rule"],
      "unsupported_rule_types": ["adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_header", "adguard_home_dns_rewrite", "adguard_home_client", "adguard_home_dnstype"],
      "unsupported_modifiers": ["dnsrewrite", "cname", "client", "dnstype", "denyallow", "ctag", "badfilter", "redirect", "removeheader", "removeparam", "app", "network", "method"],
      "conversion_notes": "支持大部分AdGuard语法，但过滤不支持的修饰符"
    },
    "adblock_plus": {
      "supported_rule_types": ["domain_rule", "exception_rule", "element_hiding_basic", "element_hiding_exception"],
      "unsupported_rule_types": ["adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule", "extended_css", "adguard_scriptlet", "regex_rule"],
      "unsupported_modifiers": ["dnsrewrite", "cname", "client", "dnstype", "denyallow", "ctag", "badfilter", "redirect", "removeheader", "removeparam", "app", "network", "method", "jsonprune", "hls", "all"],
      "conversion_notes": "类似uBlock Origin，但支持度略低"
    },
    "hosts": {
      "supported_rule_types": ["hosts_rule", "domain_rule"],
      "unsupported_rule_types": ["exception_rule", "element_hiding_basic", "element_hiding_exception", "extended_css", "adguard_scriptlet", "adguard_redirect_rule", "adguard_removeparam_rule", "adguard_csp_rule", "adguard_replace_rule", "adguard_cookie_rule", "regex_rule", "adguard_header", "adguard_jsonprune", "adguard_hls", "adguard_all", "adguard_dns_rule", "adguard_stealth_rule"],
      "rule_format": {
        "hosts_rule": "{rule}",
        "domain_rule": "0.0.0.0 {domain}"
      },
      "conversion_notes": "仅支持hosts格式规则，不支持例外规则"
    }
  },
  "common_patterns": {
    "ad_keywords": ["ad", "ads", "advert", "advertising", "adv", "banner", "promo", "popup", "track", "tracking", "analytics", "affiliate", "doubleclick", "googlead", "adsense", "taboola", "outbrain", "revcontent", "propellerads"],
    "element_selectors": [".ad-", "#ad-", "[class*=\"ad\"]", "[id*=\"ad\"]", ".banner", ".popup", ".modal", ".overlay", ".newsletter", ".subscribe", ".cookie", ".gdpr", ".social-share", ".share-buttons", "[data-ad]", "[data-ad-status]", "[data-ad-preview]"],
    "known_trackers": ["google-analytics", "googletagmanager", "facebook.net", "scorecardresearch", "hotjar", "amplitude", "mixpanel", "matomo", "piwik", "segment.io", "intercom.io", "optimizely", "clicktale", "crazyegg", "newrelic", "fullstory"],
    "adguard_home_dns_rewrite_types": ["A", "AAAA", "CNAME", "TXT", "MX", "PTR", "SRV", "SOA", "NS"],
    "adguard_redirect_resources": ["nooptext", "noopcss", "noophtml", "noopjs", "noopframe", "noopmp3", "noopmp4", "noopttf", "noopjson", "noopico", "noopvideo", "noopimage"]
  },
  "normalization_rules": {
    "domain_to_lowercase": true,
    "sort_modifiers": true,
    "remove_redundant_wildcards": true,
    "standardize_protocols": true,
    "canonicalize_domains": true,
    "adguard_home_normalize_dns_rewrite": true,
    "normalize_redirect_rules": true,
    "normalize_removeparam_rules": true,
    "normalize_csp_rules": true,
    "normalize_regex_patterns": true,
    "remove_trailing_comments": true,
    "normalize_whitespace": true,
    "validate_domain_syntax": true,
    "normalize_exception_rules": true
  },
  "validation_rules": {
    "max_rule_length": 2000,
    "min_rule_length": 3,
    "valid_domain_chars": "a-zA-Z0-9.-*",
    "valid_regex_pattern": "^/[^/\\n]+/$",
    "valid_hosts_entry": "^(?:\\d{1,3}\\.){3}\\d{1,3}\\s+[^\\s#]+",
    "valid_modifier_combinations": {
      "document": ["domain", "important", "badfilter"],
      "elemhide": ["domain", "generichide", "specifichide"],
      "redirect": ["domain", "important", "script", "image"],
      "removeparam": ["domain", "important", "third-party"],
      "dnsrewrite": ["domain", "client", "dnstype", "important"],
      "dnstype": ["domain", "client", "important"],
      "csp": ["domain", "important"],
      "replace": ["domain", "important"],
      "cookie": ["domain", "important"],
      "stealth": ["domain", "important"]
    },
    "adguard_home_specific_validation": {
      "max_dns_rewrite_length": 1000,
      "valid_dns_rewrite_types": ["A", "AAAA", "CNAME", "TXT", "MX", "PTR", "SRV", "SOA", "NS"],
      "client_modifier_pattern": "^([0-9a-fA-F.:]+|[a-zA-Z0-9.-]+)$",
      "valid_dnstype_values": ["A", "AAAA", "CNAME", "TXT", "MX", "PTR", "SRV", "SOA", "NS", "ANY", "HTTPS", "SVCB"],
      "max_dns_rewrite_records": 10
    },
    "adguard_specific_validation": {
      "valid_redirect_values": ["nooptext", "noopcss", "noophtml", "noopjs", "noopframe", "noopmp3", "noopmp4", "noopttf", "noopjson", "noopico", "noopvideo", "noopimage", "other-1st-party-resources"],
      "valid_removeparam_pattern": "^[^&=\\s]+(=[^&=\\s]*)?$",
      "valid_csp_policy_pattern": "^[a-zA-Z-\\s;]+$",
      "max_scriptlet_length": 500
    }
  },
  "performance_optimization": {
    "rule_compilation_notes": "AdGuard最近在Safari转换器上进行了优化，使过滤规则转换速度提高了30倍（从10-30秒减少到0.5-2秒）",
    "dnr_rule_handling": "AdGuard浏览器扩展MV3版本中使用预构建的DNR（Declarative Net Request）规则集，提高了性能和安全性",
    "recommended_practices": "对于大型规则集，建议使用分块处理和增量更新来优化性能",
    "bloom_filter_config": {
      "initial_capacity": 1000000,
      "error_rate": 0.001,
      "scaling_factor": 2.0,
      "max_capacity": 10000000
    }
  },
  "integrity_checks": {
    "required_fields": ["version", "syntax_patterns", "rule_types", "modifiers", "validation_rules", "platform_support"],
    "recommended_fields": ["common_patterns", "normalization_rules", "performance_optimization"],
    "version_compatibility": "4.x"
  },
  "adguard_home_specific": {
    "supported_rule_types": ["domain_rule", "exception_rule", "adguard_dns_rule", "adguard_home_dns_rewrite", "adguard_home_client", "adguard_home_dnstype", "hosts_rule", "regex_rule"],
    "unsupported_patterns": ["##", "#@#", "#%#", "$$", "script:inject", "##^", "##*"],
    "dns_rewrite_types": ["A", "AAAA", "CNAME", "TXT", "MX", "PTR", "SRV", "SOA", "NS"],
    "max_dns_rewrite_length": 1000,
    "valid_client_pattern": "^([0-9a-fA-F.:]+|[a-zA-Z0-9.-]+)$"
  }
}